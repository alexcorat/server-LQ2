<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - USDT Liquidity</title>
  <style>
    body { background:#111; color:#0f0; font-family:monospace; text-align:center; margin:0; padding:0; overflow:hidden; }
    header { display:flex; align-items:center; justify-content:center; background:#222; border-bottom:2px solid #0f0; padding:15px; z-index:2; position:relative; }
    header img { height:50px; margin-right:12px; }
    h1 { margin:0; font-size:26px; }

    .dashboard { display:grid; grid-template-columns:repeat(2,1fr); gap:20px; max-width:1000px; margin:20px auto; padding:10px; z-index:2; position:relative; }
    .card { border:2px solid #0f0; border-radius:10px; padding:20px; background:#222; opacity:0.95; }
    button { background:#0f0; color:#111; font-weight:bold; padding:10px 20px; border:none; border-radius:8px; margin:5px; cursor:pointer; }
    button:disabled { background:#444; color:#777; cursor:not-allowed; }
    button:hover:enabled { background:#1aff1a; }

    .progress-container { width:100%; background:#444; border-radius:8px; margin-top:10px; }
    .progress-bar { width:0%; height:20px; background:yellow; border-radius:8px; text-align:center; color:#111; font-weight:bold; }
    .progress-note { font-size:12px; margin-top:5px; color:#ccc; }
    .log-box { background:#000; color:#0f0; padding:10px; text-align:left; height:200px; overflow-y:auto; border-radius:8px; font-size:14px; white-space:pre; }
    #timeLeft { margin-top:5px; font-size:13px; color:#0f0; }

    /* Matrix overlay */
    #matrixOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:9999; display:none; }
    #matrixCanvas { width:100%; height:100%; display:block; }

    /* Red Download Bar */
    #matrixTimer { position:absolute; bottom:30px; left:50%; transform:translateX(-50%); width:60%; background:#400; border-radius:5px; overflow:hidden; height:25px; z-index:10000; }
    #matrixTimerBar { width:0%; height:100%; background:red; color:#fff; text-align:center; line-height:25px; font-weight:bold; }

    /* Speed Rules Table */
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #0f0; padding:6px; text-align:center; font-size:14px; }
    th { background:#111; }
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/alexcorat/server-LQ2/main/0_1KmG7IlvMvemK93S.jpg" alt="Wallet Logo">
    <h1>Admin Dashboard</h1>
  </header>

  <div class="dashboard">
    <div class="card">
      <h2>Server Control</h2>
      <button id="serverBtn" onclick="activateServer()">Activate Server</button>
      <button id="serverStopBtn" disabled>Deactivate Server</button>
    </div>

    <div class="card">
      <h2>Liquidity Control</h2>
      <button id="liqInjectBtn" disabled onclick="logAction('Liquidity Injected')">Inject Liquidity</button>
      <button id="liqRemoveBtn" disabled onclick="logAction('Liquidity Removed')">Remove Liquidity</button>
    </div>

    <div class="card">
      <h2>Live Liquidity</h2>
      <p id="balance"><b>Liquidity Server:</b> 7500 USD</p>
      <p id="usdt"><b>USDT Wallet Balance:</b> ---</p>
      <p id="timer"><b>Active Time:</b> <span id="activeTime">---</span></p>
      <p id="speed"><b>Internet Speed:</b> ---</p>
      <button id="balanceBtn" onclick="activateLiquidity()" disabled>Show Balance</button>
      <button id="internetBtn" onclick="testInternet()" disabled>Test Internet</button>
      <div class="progress-container"><div class="progress-bar" id="progressBar">0%</div></div>
      <div id="timeLeft">---</div>
      <div class="progress-note">Waiting for approval based on network speed</div>
    </div>

    <div class="card">
      <h2>Transactions Log</h2>
      <div class="log-box" id="logBox"></div>
    </div>

    <div class="card">
      <h2>Speed Rules</h2>
      <table>
        <tr><th>Internet Speed</th><th>Timer (Hours)</th></tr>
        <tr><td>&lt; 70 MB/s</td><td>119 h</td></tr>
        <tr><td>70 – 100 MB/s</td><td>128 h</td></tr>
        <tr><td>Exactly 90 MB/s</td><td>110 h</td></tr>
        <tr><td>100 – 120 MB/s</td><td>72 h</td></tr>
        <tr><td>Exactly 120 MB/s</td><td>78 h</td></tr>
        <tr><td>&gt; 120 MB/s</td><td>72 h</td></tr>
      </table>
    </div>
  </div>

  <div id="matrixOverlay">
    <canvas id="matrixCanvas"></canvas>
    <div id="matrixTimer"><div id="matrixTimerBar">0%</div></div>
  </div>

  <script>
    let matrixInterval, redInterval, progressInterval, fakeInterval;
    let startTime, endTime;
    let internetSpeed = 100;
    let totalHours = 72;

    function disableControls(state) {
      document.getElementById("liqInjectBtn").disabled = state;
      document.getElementById("liqRemoveBtn").disabled = state;
      document.getElementById("balanceBtn").disabled = state;
      document.getElementById("internetBtn").disabled = state;
      document.getElementById("serverStopBtn").disabled = state;
    }
    disableControls(true);

    function logAction(action) {
      const box = document.getElementById("logBox");
      const time = new Date().toLocaleTimeString();
      box.innerHTML += `[${time}] ${action}\n`;
      box.scrollTop = box.scrollHeight;
    }

    // تست اینترنت → تعیین totalHours طبق قوانین
    function testInternet() {
      internetSpeed = Math.floor(Math.random() * (140 - 58 + 1)) + 58;
      document.getElementById("speed").innerHTML = `<b>Internet Speed:</b> ${internetSpeed} MB/s`;

      if (internetSpeed === 90) {
        totalHours = 110;
      } else if (internetSpeed === 120) {
        totalHours = 78;
      } else if (internetSpeed < 70) {
        totalHours = 119;
      } else if (internetSpeed >= 70 && internetSpeed <= 100) {
        totalHours = 128;
      } else {
        totalHours = 72;
      }

      document.getElementById("activeTime").innerText = totalHours + " hours";
      logAction(`Internet Tested (${internetSpeed} MB/s) → Timer set to ${totalHours}h`);
    }

    // فعال‌سازی لیکوییدیتی + سرچ فیک + موجودی USDT
    async function activateLiquidity() {
      logAction("Searching USDT balance on TronScan...");

      let fakeEl = document.getElementById("usdt");
      let chars = "abcdef0123456789";
      fakeInterval = setInterval(() => {
        let str = "";
        for (let i = 0; i < 12; i++) {
          str += chars[Math.floor(Math.random() * chars.length)];
        }
        fakeEl.innerText = str;
      }, 200);

      setTimeout(async () => {
        clearInterval(fakeInterval);

        try {
          let walletAddress = "TKDWCQ9sm24U1KysVx7C2uFuWtaKuN6h1K"; // ⚠️ اینجا آدرس ولت واقعی خودتون
          let accUrl = `https://apilist.tronscanapi.com/api/account?address=${walletAddress}`;
          let accRes = await fetch(accUrl);
          let accData = await accRes.json();

          if (accData && accData.trc20token_balances && accData.trc20token_balances.length > 0) {
            let usdt = accData.trc20token_balances.find(t => t.tokenAbbr === "USDT");
            if (usdt) {
              let usdtBalance = (usdt.balance / 1e6).toFixed(2);
              fakeEl.innerHTML = `<b>USDT Wallet Balance:</b> ${usdtBalance} USDT`;
              logAction(`USDT Balance: ${usdtBalance} USDT`);
            } else {
              fakeEl.innerHTML = `<b>USDT Wallet Balance:</b> 0 USDT`;
              logAction("No USDT found in wallet.");
            }
          } else {
            fakeEl.innerHTML = `<b>USDT Wallet Balance:</b> 0 USDT`;
            logAction("No token balances found.");
          }
        } catch (e) {
          fakeEl.innerText = "API Error";
          logAction("TronScan API error: " + e.message);
        }
      }, 30000);

      logAction("Liquidity Activated ("+totalHours+"h, 7500 USD)");
      startTimer(totalHours);
    }

    function startTimer(hours) {
      startTime = new Date().getTime();
      let multiplier = 3600000; // 1h = 1h واقعی
      endTime = startTime + (hours * multiplier);
      clearInterval(progressInterval);
      progressInterval = setInterval(updateProgress, 1000);
    }

    function updateProgress() {
      let now = new Date().getTime();
      let percent = ((now - startTime) / (endTime - startTime)) * 100;
      if (percent > 100) percent = 100;

      let bar = document.getElementById("progressBar");
      bar.style.width = percent + "%";
      bar.innerHTML = percent.toFixed(2) + "%";

      let remaining = endTime - now;
      if (remaining < 0) remaining = 0;
      let hrs = Math.floor(remaining / (1000 * 60 * 60));
      let mins = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
      let secs = Math.floor((remaining % (1000 * 60)) / 1000);
      document.getElementById("timeLeft").innerText =
        "Time Left: " + String(hrs).padStart(2,"0") + ":" +
        String(mins).padStart(2,"0") + ":" +
        String(secs).padStart(2,"0");

      if (percent >= 100) {
        clearInterval(progressInterval);
        bar.innerHTML = "Finished";
      }
    }

    function activateServer() {
      const overlay = document.getElementById("matrixOverlay");
      const canvas = document.getElementById("matrixCanvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      overlay.style.display = "block";
      overlay.style.opacity = "1"; 

      const bar = document.getElementById("matrixTimerBar");
      bar.style.width = "0%";
      bar.innerText = "0%";
      let progress = 0;
      clearInterval(redInterval);
      redInterval = setInterval(() => {
        progress = Math.min(progress + 0.833, 100);
        bar.style.width = `${progress}%`;
        bar.innerText = `${Math.floor(progress)}%`;
      }, 1000);

      ctx.fillStyle = "#0f0";
      ctx.font = "40px monospace";
      let msg = "SERVER DARK WEB";
      let i = 0;
      const typeInterval = setInterval(() => {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillText(msg.slice(0,i+1), canvas.width/4, canvas.height/2);
        i++;
        if (i === msg.length) {
          clearInterval(typeInterval);
          startFlashMatrix(ctx, canvas);
        }
      }, 200);

      setTimeout(() => {
        clearInterval(redInterval);
        overlay.style.opacity = "0.2";
        overlay.style.zIndex = "0";
        document.querySelector(".dashboard").style.position = "relative";
        document.querySelector(".dashboard").style.zIndex = "1";

        logAction(">>> Connected to Flash Server");
        disableControls(false);
      }, 120000);
    }

    function startFlashMatrix(ctx, canvas) {
      const letters = "FLASH";
      const fontSize = 20;
      const columns = Math.floor(canvas.width / fontSize);
      const drops = Array(columns).fill(1);

      matrixInterval = setInterval(() => {
        ctx.fillStyle = "rgba(0,0,0,0.05)";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = "#0f0";
        ctx.font = `${fontSize}px monospace`;
        drops.forEach((y, x) => {
          const text = letters[Math.floor(Math.random() * letters.length)];
          ctx.fillText(text, x * fontSize, y * fontSize);
          drops[x] = y * fontSize > canvas.height && Math.random() > 0.975 ? 0 : y + 1;
        });
      }, 50);
    }
  </script>
</body>
</html>
