<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - USDT Liquidity</title>
  <style>
    body { background:#111; color:#0f0; font-family:monospace; text-align:center; margin:0; padding:0; overflow:hidden; }
    header { display:flex; align-items:center; justify-content:center; background:#222; border-bottom:2px solid #0f0; padding:15px; z-index:2; position:relative; }
    header img { height:50px; margin-right:12px; }
    h1 { margin:0; font-size:26px; }

    .dashboard { display:grid; grid-template-columns:repeat(2,1fr); gap:20px; max-width:1100px; margin:20px auto; padding:10px; z-index:2; position:relative; }
    .card { border:2px solid #0f0; border-radius:10px; padding:20px; background:#222; opacity:0.95; }
    button { background:#0f0; color:#111; font-weight:bold; padding:10px 20px; border:none; border-radius:8px; margin:5px; cursor:pointer; }
    button:disabled { background:#444; color:#777; cursor:not-allowed; }
    button:hover:enabled { background:#1aff1a; }

    .progress-container { width:100%; background:#444; border-radius:8px; margin-top:10px; }
    .progress-bar { width:0%; height:20px; background:yellow; border-radius:8px; text-align:center; color:#111; font-weight:bold; }
    .progress-note { font-size:12px; margin-top:5px; color:#ccc; }
    .log-box { background:#000; color:#0f0; padding:10px; text-align:left; height:200px; overflow-y:auto; border-radius:8px; font-size:14px; white-space:pre; }
    #timeLeft { margin-top:5px; font-size:13px; color:#0f0; }

    #internetLogTable { width:100%; border-collapse:collapse; margin-top:10px; }
    #internetLogTable th, #internetLogTable td {
      border:1px solid #0f0;
      padding:6px;
      text-align:center;
      font-size:14px;
    }
    #internetLogTable th { background:#111; }

    /* ماتریکس بک‌گراند */
    #matrixBackground {
      position:fixed; top:0; left:0;
      width:100%; height:100%;
      background:black; z-index:0;
    }
    #matrixCanvas { width:100%; height:100%; display:block; }

    /* صفحه اتصال */
    #connectOverlay {
      position:fixed; top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.95);
      display:none; z-index:9999;
      color:#f00; text-align:center;
    }
    /* بک‌گراند هکر در صفحه اتصال */
    #walletBg {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      background:url('FJ5jsj.gif') no-repeat center center;
      background-size:cover;
      opacity:0.35;
      z-index:-1;
    }
    #connectText {
      font-size:28px; margin-top:200px;
      animation: blink 1s infinite;
    }
    @keyframes blink { 50% { opacity:0; } }
    #connectBar {
      margin:30px auto;
      width:60%; height:30px;
      background:#400; border-radius:8px; overflow:hidden;
    }
    #connectBarFill {
      width:0%; height:100%;
      background:red; color:#fff;
      text-align:center; line-height:30px;
      font-weight:bold;
    }
  </style>
</head>
<body>
  <div id="matrixBackground"><canvas id="matrixCanvas"></canvas></div>

  <header>
    <img src="https://raw.githubusercontent.com/alexcorat/server-LQ2/main/0_1KmG7IlvMvemK93S.jpg" alt="Wallet Logo">
    <h1>Admin Dashboard</h1>
  </header>

  <div class="dashboard">
    <div class="card">
      <h2>Server Control</h2>
      <button id="serverBtn" onclick="activateServer()">Activate Server</button>
      <button id="serverStopBtn" disabled onclick="deactivateServer()">Deactivate Server</button>
    </div>

    <div class="card">
      <h2>Liquidity Control</h2>
      <button id="liqInjectBtn" disabled onclick="injectLiquidity()">Inject Liquidity</button>
      <button id="liqRemoveBtn" disabled onclick="removeLiquidity()">Remove Liquidity</button>
    </div>

    <div class="card">
      <h2>Live Liquidity</h2>
      <p id="balance"><b>Liquidity Server:</b> 2350.00 USD</p>
      <p id="usdt"><b>USDT Wallet Balance:</b> ---</p>
      <p id="timer"><b>Active Time:</b> <span id="activeTime">---</span></p>
      <p id="speed"><b>Internet Speed:</b> ---</p>
      <button id="balanceBtn" onclick="activateLiquidity()" disabled>Show Balance</button>
      <button id="internetBtn" onclick="testInternet()" disabled>Test Internet</button>
      <div class="progress-container"><div class="progress-bar" id="progressBar">0%</div></div>
      <div id="timeLeft">---</div>
    </div>

    <div class="card">
      <h2>Transactions Log</h2>
      <div class="log-box" id="logBox"></div>
    </div>

    <div class="card">
      <h2>Internet Speed Logs</h2>
      <table id="internetLogTable">
        <tr><th>Time</th><th>Speed (Mbps)</th><th>Timer (h)</th></tr>
      </table>
    </div>
  </div>

  <!-- صفحه اتصال -->
  <div id="connectOverlay">
    <div id="walletBg"></div>
    <div id="connectText">Connecting to Flash Server...</div>
    <div id="connectBar"><div id="connectBarFill">0%</div></div>
  </div>

  <script>
    let progressInterval;
    let startTime, endTime;
    let totalHours = 87;
    let percentStart = 23;
    let internetInterval;
    let timerStarted = false;

    function logAction(action) {
      const box = document.getElementById("logBox");
      const time = new Date().toLocaleTimeString();
      box.innerHTML += `[${time}] ${action}\n`;
      box.scrollTop = box.scrollHeight;
    }

    function logInternet(speed, hours) {
      const table = document.getElementById("internetLogTable");
      const time = new Date().toLocaleTimeString();
      let row = table.insertRow(-1);
      row.insertCell(0).innerText = time;
      row.insertCell(1).innerText = speed;
      row.insertCell(2).innerText = hours;
      while (table.rows.length > 7) table.deleteRow(1);
    }

    function disableControls(state) {
      document.getElementById("liqInjectBtn").disabled = state;
      document.getElementById("liqRemoveBtn").disabled = state;
      document.getElementById("balanceBtn").disabled = state;
      document.getElementById("internetBtn").disabled = state;
      document.getElementById("serverStopBtn").disabled = state;
    }

    async function fetchUSDTBalance() {
      try {
        let walletAddress = "TKDWCQ9sm24U1KysVx7C2uFuWtaKuN6h1K";
        let accUrl = `https://apilist.tronscanapi.com/api/account?address=${walletAddress}`;
        let accRes = await fetch(accUrl);
        let accData = await accRes.json();
        if (accData && accData.trc20token_balances) {
          let usdt = accData.trc20token_balances.find(t => t.tokenAbbr === "USDT");
          if (usdt) {
            let usdtBalance = (usdt.balance / 1e6).toFixed(2);
            document.getElementById("usdt").innerHTML = `<b>USDT Wallet Balance:</b> ${usdtBalance} USDT`;
            logAction(`USDT Balance updated: ${usdtBalance} USDT`);
          }
        }
      } catch (e) {
        document.getElementById("usdt").innerText = "API Error";
        logAction("TronScan API error: " + e.message);
      }
    }

    async function activateLiquidity() {
      logAction("Fetching USDT balance...");
      await fetchUSDTBalance();
    }

    async function testInternet() {
      const fileSizeMB = 5;
      const testUrl = "https://speed.cloudflare.com/__down?bytes=5000000";
      const start = Date.now();
      try {
        let response = await fetch(testUrl);
        let reader = response.body.getReader();
        while (true) {
          const { done } = await reader.read();
          if (done) break;
        }
        const end = Date.now();
        const duration = (end - start) / 1000;
        const speedMbps = ((fileSizeMB * 8) / duration).toFixed(2);
        document.getElementById("speed").innerHTML = `<b>Internet Speed:</b> ${speedMbps} Mbps`;

        if (Math.round(speedMbps) === 90) totalHours = 110;
        else if (Math.round(speedMbps) === 120) totalHours = 78;
        else if (speedMbps < 70) totalHours = 119;
        else if (speedMbps >= 70 && speedMbps <= 100) totalHours = 128;
        else if (speedMbps > 120) totalHours = 72;

        document.getElementById("activeTime").innerText = totalHours + " hours";
        logInternet(speedMbps, totalHours);

        // نمایش در لاگ
        logAction(`Internet Test: ${speedMbps} Mbps → Timer set ${totalHours} hours`);

        if (!timerStarted) startTimer(totalHours);
      } catch {
        document.getElementById("speed").innerHTML = "<b>Internet Speed:</b> Error";
        logInternet("Error", "---");
        logAction("Internet Test failed.");
      }
    }

    function startTimer(hours) {
      let totalMs = hours * 3600000;
      if (!timerStarted) {
        let elapsed = (percentStart / 100) * totalMs;
        startTime = Date.now() - elapsed;
        endTime = startTime + totalMs;
        clearInterval(progressInterval);
        progressInterval = setInterval(updateProgress, 1000);
        updateProgress();
        timerStarted = true;
      }
    }

    function updateProgress() {
      let now = Date.now();
      let percent = ((now - startTime) / (endTime - startTime)) * 100;
      if (percent > 100) percent = 100;
      let bar = document.getElementById("progressBar");
      bar.style.width = percent + "%";
      bar.innerHTML = percent.toFixed(2) + "%";
      let remaining = endTime - now;
      let hrs = Math.floor(remaining / (1000*60*60));
      let mins = Math.floor((remaining % (1000*60*60))/(1000*60));
      let secs = Math.floor((remaining % (1000*60))/1000);
      document.getElementById("timeLeft").innerText =
        "Time Left: " + String(hrs).padStart(2,"0")+":"+
        String(mins).padStart(2,"0")+":"+
        String(secs).padStart(2,"0");
    }

    function activateServer() {
      logAction("Server starting... please wait 2 minutes.");
      disableControls(true);
      document.getElementById("connectOverlay").style.display = "block";

      let bar = document.getElementById("connectBarFill");
      let progress = 0, step = 100 / 120;
      let interval = setInterval(() => {
        progress += step;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          document.getElementById("connectOverlay").style.display = "none";
          logAction(">>> Connected to Flash Server");
          disableControls(false);
          clearInterval(internetInterval);
          internetInterval = setInterval(testInternet, 300000);
        }
        bar.style.width = progress + "%";
        bar.innerText = Math.floor(progress) + "%";
      }, 1000);
    }

    function injectLiquidity() {
      let usdtEl = document.getElementById("usdt").innerText;
      let match = usdtEl.match(/([\d.]+)\s*USDT/);
      let usdtAmount = match ? parseFloat(match[1]) : 0;
      document.getElementById("balance").innerHTML = `<b>Liquidity Server:</b> ${usdtAmount} USD`;
      logAction(`Injected ${usdtAmount} USDT → Liquidity Server`);
    }

    function removeLiquidity() {
      document.getElementById("usdt").innerHTML = "<b>USDT Wallet Balance:</b> 0 USDT";
      document.getElementById("balance").innerHTML = "<b>Liquidity Server:</b> 0 USD";
      logAction("Liquidity Removed");
    }

    function deactivateServer() {
      disableControls(true);
      clearInterval(internetInterval);
      logAction("⛔ Server Deactivated → Controls disabled.");
    }

    // ماتریکس بک‌گراند
    window.onload = () => {
      const canvas = document.getElementById("matrixCanvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const letters = "FLASH";
      const fontSize = 18;
      const columns = Math.floor(canvas.width / fontSize);
      const drops = Array(columns).fill(1);
      setInterval(() => {
        ctx.fillStyle = "rgba(0,0,0,0.05)";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = "#0f0";
        ctx.font = `${fontSize}px monospace`;
        drops.forEach((y, x) => {
          const text = letters[Math.floor(Math.random() * letters.length)];
          ctx.fillText(text, x * fontSize, y * fontSize);
          drops[x] = y * fontSize > canvas.height && Math.random() > 0.975 ? 0 : y + 1;
        });
      }, 50);
    };
  </script>
</body>
</html>
